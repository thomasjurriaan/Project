Thomas van der Veen (10346481)
# An insight in European integration

##### Proposal

This  visualization shows how the Europe is integrating economically by analysing flows of import and export (in goods and services) between European countries over the time. There are two types of flow between countries – import and export. The accumulation of these flows can be seen over time by selecting a country on the map.  It shows this data in a line graph on the right side of the map. Both the flows are displayed in the same colour but with a different line style. Because the year in which each country entered the Schengen zone* is marked in the line graph as well, the user can distinguish the impact of joining the zone on intercontinental trade. The selected country is highlighted in the same colour and thus the map is functioning as a legend. The graph shows only the total imports and exports for a certain country. To give more specific information on the flows, the five most important import and export countries can be seen on the map itself. They are represented by arcs, of which the width codes for the size of the flow. The arcs only show the data for a certain year, which can be selected using the slider. The user can switch between import and export flows using the buttons in the top left corner. This way you can see how import and export partners change over time.

##### Design
I will explain how this visualization comes to place chronologically, i.e. what’s first executed is discussed first. At first, the global variables are instantiated. They need to be global to make the different sections of the visualization interact with each other. There is a startYear and an endYear, the data is global, as is the slider. Both parts use these functions, but don’t change them. 
The graph scales to the maximum value that appears in the data it is currently visualizing. Therefore there are list that contain the data points for all the lines in the graph and the countries currently in the graph. When a country is selected by a click on the svg representing the country, its data is appended to these three lists and when that country is deselected (by clicking again), its data is removed from the lists. There is also a global lists containing the colour per land. When a country is selected, the next colour in the colour array is appointed to this country, but when a country is deselected, its colour is not removed, but set to default, as datamaps doesn’t reset it automatically. Every change in colour of the map goes by updating this list.

One country is already put in the graph to give the user an idea of its functionality. More countries can be added by clicking on a country. The graph is drawn first. This function is quite long, as there are many steps and different cases. It checks whether there is a selection or deselection. In the case of deselection the data is removed from the global lists, the elements belonging to the country are removed. Otherwise the data is retrieved and adjusted for the use in the graph. The maximum value is determined and based on that the scales and lines created. The line graph is scalable and react on a change in window size. 

drawLines is the function that draws the arcs between countries on the map. If there is no data available for the combination of a certain period and country, the country is coloured grey. When the user slides to a year for which there is data available, the country will get the same colour as its line in the graph. This happens as well when another country is selected. This way, the idea of the map being a legend, remains intact. The arcs are drawn using the arc function in the d3 library. This function takes real world coordinates as input and draws the arcs. I did not have the coordinates so I used a trick to work around this. There is a function in datamaps called labels, that puts a label in the centre of a country path. With the location of this point, I could draw the arcs. When the graphData is loaded, the centre of each country in Europe is added as HTML property to its HTML element. These coordinates are, however, not real world coordinates. I changed the datamaps file so it doesn’t transform the real world coordinates to datamaps coordinates. Then the arcs were drawn correctly.

##### Process
This section will discuss the process of my visualization, containing the choices I made and the obstacles I met along the way. As readable in the proposal for this project, I had some ambitious plans for the visualization. The reason that the outcome of the project differs from what I intended to make is mostly that I wasn’t able to do it in this amount of time. Even the technical problems could easily have been dealt with, but I chose to prioritize the main parts of the visualization. As an example: I wanted to make the integration of Europe visible using multiple sources of data.

1.	Flows of goods and services (import and export)
2.	Flows of labour (people living in one country, but working in another)
3.	Flows of migration (People moving permanently from one country to another)

But after finding, filtering and adjusting all the flows of goods and services around the world from 1870 until 2009, the first week had past, in which I also tried to get a better understanding in d3, in which I was not proficient. In processing the data there were some difficulties in historical changes. Germany was, until 1989 divided in two countries. The opposite was the case with Yugoslavia, where one country separated into multiple ones. In the former case, I chose to accumulate the data. So for Germany, the data before the union is a simple addition from the two countries combined. In the latter case, it is not traceable for which part the different current countries in former Yugoslavia, were responsible in the total flow. For the years before that the data is thus not available. 

I wanted my visualization to consist of two parts. The graph and the map. In the required course Data processing we already had to work with the D3 library and datamaps. I used this term in the part above, but have elaborated on my decision to use it or what it is. Datamaps is a mapping tool relying heavily on the d3 library and topoJSON. 

There were, in the proposal three ways to visualize the data, the line graph, the arcs, representing the flows, and the last would have been bars on each country, showing the total import and export for the selected year. The problem with the bars was finding the centre of each country path. This problem appeared for the arcs as well. But the coordinates that are in the datamaps file are neither real coordinates, nor pixels in HTML. Datamaps processes their value under the hood. The way I would have solved this, given more time, is by changing datamaps’ code, just like the solution to the arc problem. In this case I would have used the code for placing labels, but instead of text give two heights as argument and draw two svg:rects. This decision was one of merely postponing the fix because it had lower priority. I thought it was better to  have a smoothly running visualization than add extra functions, probably containing bugs. 

At some point in coding, when the line graph was running smoothly and adjusting the axes to the values in the graph, I had an impulse and spent quite some time trying to make the whole visualization scalable, to let is change when the window size was altered. This works now for the line graph, but not for datamaps. Maybe, in that time I could have gotten the bars on my map. Which had a higher priority than scaling. 
